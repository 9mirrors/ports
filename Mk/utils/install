#!/bin/rc
rfork ne

. /sys/ports/Config/ports.conf
. /sys/ports/Mk/pkg.rc

fn quiet {
	$* >/dev/null >[2=1]
}

fn bail {
	quiet mk nuke
	exit $"*
}

if(~ $#1 0){
	echo 'Usage: port/install [portname]'
	exit 'no args'
}

PORTNAME=$1
if (! cd $PORTS^''^$PORTNAME) {
	echo 'Port not found'
	exit 'bad portname'
}
if(! checkport $PORTNAME){
	echo -n 'Installing '^$PORTNAME^' '
	echo -n 'fetch.. '; quiet mk fetch || bail 'fetch: '^$status
	echo -n 'build.. '; quiet mk build || bail 'build: '^$status
	echo -n 'install.. '; quiet mk install || bail 'install: '^$status
	if(! $status){
		echo 'done.'
		exit ''
	}
	if not {
		echo 'port '^$PORTNAME^' failed to install'
		exit 'failed to install'
	}
}
if not {
	echo 'Port '^$PORTNAME^' is already installed'
	exit 'Port installed'
}
